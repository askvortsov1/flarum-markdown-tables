module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.extensions["askvortsov-rich-text"]},function(e,t){e.exports=flarum.core.compat.app},function(e,t){e.exports=flarum.core.compat["components/Post"]},function(e,t){e.exports=flarum.core.compat["common/components/Button"]},function(e,t){e.exports=flarum.core.compat["common/components/Dropdown"]},function(e,t){e.exports=flarum.core.compat["common/helpers/icon"]},function(e,t){e.exports=flarum.core.compat["common/helpers/listItems"]},function(e,t,r){"use strict";r.r(t);var n=r(2),o=r.n(n),a=r(0),i=r(3),l=r.n(i);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=r(4),u=r.n(c),d=r(5),f=r.n(d),p=r(6),b=r.n(p),h=r(7),v=r.n(h);function y(e){return[e.nodes.table,e.nodes.table_head,e.nodes.table_body,e.nodes.table_row,e.nodes.table_cell,e.nodes.table_header]}function g(e){return y(e.schema).includes(e.selection.$head.parent.type)}function _(e){return e.selection.$head.parent.type===e.schema.nodes.table_header}function k(e,t){return w(e,t,!1)}function w(e,t,n){void 0===n&&(n=!1);var o=e.schema;if(!g(e))return!1;if(t){var a=o.nodes.paragraph,i=n?e.selection.$head.before(-3)-1:e.selection.$head.after(-3)+1,l=e.tr;try{l.doc.resolve(i)}catch(e){var s=n?i+1:i-1;l.insert(s,a.create())}l.setSelection(r(1).Selection.near(l.doc.resolve(Math.max(0,i)),1)),t(l.scrollIntoView())}return!0}function x(e,t){return O(!0,e,t)}function M(e,t){return O(!1,e,t)}function O(e,t,r){var n=t.schema;if(!g(t)||_(t))return!1;if(r){var o=t.selection.$head,a=o.node(-1),i=[];a.forEach(function(e){i.push(n.nodes.table_cell.create(e.attrs))});var l=n.nodes.table_row.create(null,i),s=e?o.before(-1):o.after(-1);r(t.tr.insert(s,l).scrollIntoView())}return!0}function A(e,t){return B(!1,e,t)}function D(e,t){return B(!0,e,t)}function B(e,t,r){var n=t.schema;if(!g(t))return!1;if(r){var o,a=t.selection.$head,i=a.node(-3),l=a.index(-1),s=[],c=a.start(-3);i.descendants(function(t,r){if(!y(n).includes(t.type))return!1;if(t.type===n.nodes.table_row&&(o=t.child(l)),o&&t==o){var a=e?i.resolve(r+1).before():i.resolve(r+1).after();s.push([t.type,c+a])}});var u=t.tr,d=s.reverse(),f=Array.isArray(d),p=0;for(d=f?d:d[Symbol.iterator]();;){var b;if(f){if(p>=d.length)break;b=d[p++]}else{if((p=d.next()).done)break;b=p.value}var m=b;u=u.insert(m[1],m[0].create())}r(u.scrollIntoView())}return!0}function S(e,t){if(!g(e)||_(e))return!1;if(t){var r=e.tr,n=e.selection.$head;if(1===n.node(-2).childCount)return I(e,t);r.delete(n.start(-1)-1,n.end(-1)+1),t(r.scrollIntoView())}return!0}function j(e,t){var r=e.schema;if(!g(e))return!1;if(t){var n=e.selection.$head,o=n.node(-3);if(1===n.node(-1).childCount)return I(e,t);var a,i=n.index(-1),l=[],s=n.start(-3);o.descendants(function(e,t){if(!y(r).includes(e.type))return!1;e.type===r.nodes.table_row&&(a=e.childCount>=i+1?e.child(i):null),a&&e==a&&l.push(o.resolve(t+1))});var c=e.tr,u=l.reverse(),d=Array.isArray(u),f=0;for(u=d?u:u[Symbol.iterator]();;){var p;if(d){if(f>=u.length)break;p=u[f++]}else{if((f=u.next()).done)break;p=f.value}var b=p;c=c.delete(s+b.start()-1,s+b.end()+1)}t(c.scrollIntoView())}return!0}function E(e,t){if(!g(e))return!1;var r=e.selection,n=r.$from,o=r.$to;return n.start(-3)>=n.pos-3&&n.end(-3)<=o.pos+3?I(e,t):n.start(-1)>=n.pos-1&&n.end(-1)<=o.pos+1?S(e,t):!n.sameParent(o)}function T(e,t,n){if(-1!==n&&1!==n)return!1;if(!g(e))return!1;for(var o=e.selection.$head,a=-1;a>-4;a--){var i=o.index(a),l=o.node(a);if(l){if(l.maybeChild(i+n)){var s=-1===n?o.start()- -1*a*2:o.end()+-1*a*2;return t(e.tr.setSelection(r(1).Selection.near(e.tr.doc.resolve(s),1)).scrollIntoView()),!0}}}return 1===n?k(e,t):function(e,t){return w(e,t,!0)}(e,t)}function $(e,t){return T(e,t,1)}function I(e,t){var r=e.selection.$head;return t&&t(e.tr.deleteRange(r.start(-3)-1,r.end(-3)+1)),!0}function P(e,t){var r=e.schema;if(!t)return!0;var n=1,o=1,a=function(){return r.nodes.table_cell.create(null,r.text("cell "+o++))},i=function(){return r.nodes.table_header.create(null,r.text("header "+n++))},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.nodes.table_row.create(null,t)},s=function(e,t){return r.nodes.table.createChecked(null,[e,t])}(function(e){return r.nodes.table_head.create(null,e)}(l(i(),i(),i())),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.nodes.table_body.create(null,t)}(l(a(),a(),a()),l(a(),a(),a()),l(a(),a(),a()))),c=e.tr.replaceSelectionWith(s);t(c.scrollIntoView());var u=e.apply(c),d=u.doc.nodeAt(u.tr.selection.to-1);return d&&d.type===r.nodes.text&&t((c=u.tr.insert(u.tr.selection.to,r.nodes.paragraph.create(null))).scrollIntoView()),!0}var N=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var o=n.prototype;return o.oninit=function(t){var r=this;e.prototype.oninit.call(this,t),this.state=this.attrs.state,this.state.addItem(this.attrs.type,function(e,t){return r.command(e,t)},this.onEditorUpdate.bind(this))},o.oncreate=function(t){e.prototype.oncreate.call(this,t),this.$('[data-toggle="tooltip"]').tooltip(),this.$().on("click",this.onclick.bind(this))},o.getButton=function(e){return m("button",{className:"Dropdown-toggle Button Button--icon Button--link Button--menuDropdown","data-toggle":"dropdown"},m("span",{"data-toggle":"tooltip",title:this.attrs.tooltip},b()(this.attrs.icon)))},o.getMenu=function(e){var t=this,r=[{translation:"remove_column",command:j},{translation:"insert_column_before",command:D},{translation:"insert_column_after",command:A},{translation:"remove_row",command:S},{translation:"insert_row_before",command:x},{translation:"insert_row_after",command:M}];return m("ul",{className:"Dropdown-menu dropdown-menu TableDropdownMenu"},v()(r.map(function(e){return m(u.a,{onclick:t.click.bind(t,e.command),onkeydown:t.keydown.bind(t,e.command)},app.translator.trans("askvortsov-pipetables.forum.composer.table_menu."+e.translation))})))},o.inTable=function(){return g(this.attrs.state.editorView.state)},o.onclick=function(e){this.inTable()||(this.command=P,this.state.run(this.attrs.type),e.preventDefault(),e.stopPropagation())},o.onEditorUpdate=function(){this.currInTable=this.inTable()},o.keydown=function(e,t){" "!==t.key&&"Enter"!==t.key||this.click(e,t)},o.click=function(e,t){return t.preventDefault(),this.command=e,this.state.run(this.attrs.type)},n}(f.a),V={"Mod-Enter":k,"Shift-Enter":k,Enter:$,Backspace:E,Delete:E,"Mod-Backspace":E,"Mod-Delete":E,Tab:$,"Shift-Tab":function(e,t){return T(e,t,-1)}},C={content:"table_head table_body*",isolating:!0,group:"block",selectable:!1,parseDOM:[{tag:"table"}],toDOM:function(){return["div",{class:"s-table-container"},["table",{class:"s-table"},0]]}},L={content:"table_row",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"thead"}],toDOM:function(){return["thead",0]}},z={content:"table_row+",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"tbody"}],toDOM:function(){return["tbody",0]}},G={content:"(table_cell | table_header)+",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}},U={content:"inline*",isolating:!0,group:"table_block",selectable:!1,attrs:{style:{default:null}},parseDOM:[{tag:"td",getAttrs:function(e){var t=e.style.textAlign;return t?{style:"text-align: "+t}:null}}],toDOM:function(e){return["td",e.attrs,0]}},K={content:"inline*",isolating:!0,group:"table_block",selectable:!1,attrs:{style:{default:null}},parseDOM:[{tag:"th",getAttrs:function(e){var t=e.style.textAlign;return t?{style:"text-align: "+t}:null}}],toDOM:function(e){return["th",e.attrs,0]}};function R(){var e=r(1).components.ProseMirrorMenu;Object(a.extend)(e.prototype,"items",function(e){e.add("table",N.component({type:"table",icon:"fas fa-table",tooltip:app.translator.trans("askvortsov-pipetables.forum.composer.table_tooltip"),state:this.attrs.state}),10)});var t=r(1).proseMirror.markdown.MarkdownSerializerBuilder;Object(a.extend)(t.prototype,"buildNodes",function(e){var t=this.schema;e.table=function(e,r){function n(r){var n=[];return r.forEach(function(r){if(r.type===t.nodes.table_header||r.type===t.nodes.table_cell){var o=function(t){return e.write("| "),e.renderInline(t),e.write(" "),function(e){var t=e.attrs.style;if(!t)return null;var r=t.match(/text-align:[ ]?(left|right|center)/);return r&&r[1]?r[1]:null}(t)}(r);n.push(o)}}),e.write("|"),e.ensureNewLine(),n}r.forEach(function(r){"table_head"===r.type.name&&function(r){var o=[];r.forEach(function(e){e.type===t.nodes.table_row&&(o=n(e))});var a=o,i=Array.isArray(a),l=0;for(a=i?a:a[Symbol.iterator]();;){var s;if(i){if(l>=a.length)break;s=a[l++]}else{if((l=a.next()).done)break;s=l.value}var c=s;e.write("|"),e.write("left"===c||"center"===c?":":" "),e.write("---"),e.write("right"===c||"center"===c?":":" ")}e.write("|"),e.ensureNewLine()}(r),"table_body"===r.type.name&&(r.forEach(function(e){e.type===t.nodes.table_row&&n(e)}),e.ensureNewLine())}),e.ensureNewLine(),e.write("\n")}});var n=r(1).proseMirror.markdown.MarkdownParserBuilder;Object(a.extend)(n.prototype,"buildTokens",function(e){s(e,{table:{block:"table"},thead:{block:"table_head"},tbody:{block:"table_body"},th:{block:"table_header",getAttrs:function(e){return{style:e.attrGet("style")}}},tr:{block:"table_row"},td:{block:"table_cell",getAttrs:function(e){return{style:e.attrGet("style")}}}})}),Object(a.extend)(n.prototype,"buildTokenizer",function(e){e.enable("table")});var o=r(1).proseMirror.markdown.SchemaBuilder;Object(a.override)(o.prototype,"buildNodes",function(e){return e().addBefore("image","table",C).addBefore("image","table_head",L).addBefore("image","table_body",z).addBefore("image","table_row",G).addBefore("image","table_cell",U).addBefore("image","table_header",K)});var i=r(1).proseMirror.ProseMirrorEditorDriver;Object(a.extend)(i.prototype,"buildPluginItems",function(e){e.add("tableKeymap",r(1).keymap(V),10)})}o.a.initializers.add("askvortsov-pipetables",function(){Object(a.extend)(l.a.prototype,"oncreate",function(){function e(e){var t=[],r=e.getElementsByTagName("th"),n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var a;if(n){if(o>=r.length)break;a=r[o++]}else{if((o=r.next()).done)break;a=o.value}var i=a;t.push(i.textContent)}var l=e.getElementsByTagName("tr"),s=Array.isArray(l),c=0;for(l=s?l:l[Symbol.iterator]();;){var u;if(s){if(c>=l.length)break;u=l[c++]}else{if((c=l.next()).done)break;u=c.value}var d=-1,f=u.getElementsByTagName("td"),p=Array.isArray(f),b=0;for(f=p?f:f[Symbol.iterator]();;){var m;if(p){if(b>=f.length)break;m=f[b++]}else{if((b=f.next()).done)break;m=b.value}m.setAttribute("data-label",t[++d]||"")}}}var t=document.getElementsByTagName("table"),r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var o;if(r){if(n>=t.length)break;o=t[n++]}else{if((n=t.next()).done)break;o=n.value}e(o)}}),"askvortsov-rich-text"in flarum.extensions&&R()})}]);
//# sourceMappingURL=forum.js.map