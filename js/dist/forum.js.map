{"version":3,"sources":["webpack://@askvortsov/pipetables/webpack/bootstrap","webpack://@askvortsov/pipetables/external \"flarum.extensions['askvortsov-rich-text']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['extend']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['common/utils/Stream']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['app']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['components/Post']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['common/components/Button']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['common/components/Switch']\"","webpack://@askvortsov/pipetables/external \"flarum.core.compat['common/helpers/listItems']\"","webpack://@askvortsov/pipetables/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@askvortsov/pipetables/./src/forum/proseMirror/commands.js","webpack://@askvortsov/pipetables/./src/forum/components/TableDropdown.js","webpack://@askvortsov/pipetables/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@askvortsov/pipetables/./src/forum/proseMirror/tableKeymap.js","webpack://@askvortsov/pipetables/./src/forum/proseMirror/tableSchema.js","webpack://@askvortsov/pipetables/./src/forum/configureRichText.js","webpack://@askvortsov/pipetables/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","extensions","core","compat","_extends","assign","target","arguments","length","source","apply","this","tableNodes","schema","nodes","table","table_head","table_body","table_row","table_cell","table_header","inTable","state","includes","selection","$head","parent","type","inTableHead","moveSelectionAfterTableCommand","dispatch","exitTableCommand","before","paragraph","newPosition","after","tr","doc","resolve","e","insertionPosition","insert","setSelection","require","Selection","near","Math","max","scrollIntoView","insertTableRowBeforeCommand","insertTableRowCommand","insertTableRowAfterCommand","tableRowNode","node","newTableCells","forEach","cell","push","attrs","newTableRow","positionToInsert","insertTableColumnAfterCommand","insertTableColumnCommand","insertTableColumnBeforeCommand","targetCell","selectedTable","selectedCellIndex","index","newCells","tableOffset","start","descendants","pos","child","position","_iterator","reverse","_isArray","Array","isArray","_i","iterator","_ref","next","done","newCell","removeRowCommand","childCount","removeTableCommand","delete","end","removeColumnCommand","cellIndex","resolvedPositions","_iterator2","_isArray2","_i2","_ref2","cellPosition","removeTableContentCommand","_state$selection","$from","$to","sameParent","moveToCellCommand","direction","level","parentIndex","maybeChild","newPos","moveSelectionBeforeTableCommand","moveToNextCellCommand","deleteRange","TableDropdown","_FormDropdown","subClass","superClass","constructor","__proto__","_proto","oninit","vnode","_this","addItem","command","onEditorUpdate","numCols","Stream","numRows","labelCells","getMenu","items","_this2","commands","translation","className","listItems","map","Button_default","a","onclick","click","onkeydown","keydown","app","translator","trans","fields","add","placeholder","extractText","bidi","required","Switch","component","onchange","editorView","currInTable","preventDefault","run","parseInt","headerIndex","text","row","_len","cells","_key","head","body","createChecked","fill","_len2","rows","_key2","_","replaceSelectionWith","newState","nodeAfterTable","nodeAt","to","components","FormDropdown","tableKeymap","Mod-Enter","Shift-Enter","Enter","Backspace","Delete","Mod-Backspace","Mod-Delete","Tab","Shift-Tab","tableNodeSpec","content","isolating","group","selectable","parseDOM","tag","toDOM","class","tableHeadNodeSpec","tableBodyNodeSpec","tableRowNodeSpec","tableCellNodeSpec","style","default","getAttrs","dom","textAlign","tableHeaderNodeSpec","configureRichText","ProseMirrorMenu","TableDropdownComponent","extend","icon","tooltip","MarkdownSerializerBuilder","proseMirror","markdown","richTextSchema","serializeTableRow","columnAlignment","alignment","write","renderInline","match","findAlignment","serializeTableCell","ensureNewLine","table_child","columnAlignments","headRow","serializeTableHead","bodyRow","MarkdownParserBuilder","tokens","block","thead","tbody","th","tok","attrGet","td","tokenizer","enable","SchemaBuilder","override","original","addBefore","ProseMirrorEditorDriver","keymap","initializers","Post","addDataLabelsToTable","labels","getElementsByTagName","textContent","_iterator3","_isArray3","_i3","_ref3","setAttribute","_iterator4","document","_isArray4","_i4","_ref4"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","module.exports = flarum.extensions['askvortsov-rich-text'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['common/helpers/listItems'];","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","function tableNodes(schema) {\n    return [\n        schema.nodes.table,\n        schema.nodes.table_head,\n        schema.nodes.table_body,\n        schema.nodes.table_row,\n        schema.nodes.table_cell,\n        schema.nodes.table_header,\n    ];\n}\n\nexport function inTable(state) {\n    return tableNodes(state.schema).includes(state.selection.$head.parent.type);\n}\n\nfunction inTableHead(state) {\n    return state.selection.$head.parent.type === state.schema.nodes.table_header;\n}\n\nexport function moveSelectionAfterTableCommand(\n    state,\n    dispatch\n) {\n    return exitTableCommand(state, dispatch, false);\n}\n\nexport function moveSelectionBeforeTableCommand(\n    state,\n    dispatch\n) {\n    return exitTableCommand(state, dispatch, true);\n}\n\nfunction exitTableCommand(\n    state,\n    dispatch,\n    before = false\n) {\n    // TODO: Cleanup\n    const schema = state.schema;\n\n    if (!inTable(state)) {\n        return false;\n    }\n\n    if (dispatch) {\n        // our hierarchy is table > table_head | table_body > table_row > table_cell\n        // and we're relying on that to be always true.\n        // That's why .after(-3) selects the parent _table_ node from a table_cell node\n        const type = schema.nodes.paragraph;\n        const newPosition = before\n            ? state.selection.$head.before(-3) - 1\n            : state.selection.$head.after(-3) + 1;\n        const tr = state.tr;\n\n        // if the position before/after the table doesn't exist, let's insert a paragraph there\n        try {\n            tr.doc.resolve(newPosition);\n        } catch (e) {\n            const insertionPosition = before\n                ? newPosition + 1\n                : newPosition - 1;\n            tr.insert(insertionPosition, type.create());\n        }\n\n        tr.setSelection(\n            require('@askvortsov-rich-text').Selection.near(tr.doc.resolve(Math.max(0, newPosition)), 1)\n        );\n        dispatch(tr.scrollIntoView());\n    }\n    return true;\n}\n\nexport function insertTableRowBeforeCommand(\n    state,\n    dispatch\n) {\n    return insertTableRowCommand(true, state, dispatch);\n}\n\nexport function insertTableRowAfterCommand(\n    state,\n    dispatch\n) {\n    return insertTableRowCommand(false, state, dispatch);\n}\n\nfunction insertTableRowCommand(\n    before,\n    state,\n    dispatch\n) {\n    // TODO: Cleanup\n    const schema = state.schema;\n\n    if (!inTable(state) || inTableHead(state)) {\n        return false;\n    }\n\n    if (dispatch) {\n        const { $head } = state.selection;\n        const tableRowNode = $head.node(-1);\n\n        const newTableCells = [];\n        tableRowNode.forEach((cell) => {\n            newTableCells.push(schema.nodes.table_cell.create(cell.attrs));\n        });\n        const newTableRow = schema.nodes.table_row.create(null, newTableCells);\n        const positionToInsert = before ? $head.before(-1) : $head.after(-1);\n        const tr = state.tr.insert(positionToInsert, newTableRow);\n\n        dispatch(tr.scrollIntoView());\n    }\n\n    return true;\n}\n\nexport function insertTableColumnAfterCommand(\n    state,\n    dispatch\n) {\n    return insertTableColumnCommand(false, state, dispatch);\n}\n\nexport function insertTableColumnBeforeCommand(\n    state,\n    dispatch\n) {\n    return insertTableColumnCommand(true, state, dispatch);\n}\n\n/**\n *  Insert a new table column in this table\n * 1. find the index of the selected table cell in the current table row\n * 2. walk through the entire document to traverse all rows in our selected table\n * 3. for each table row, find the table cell at the desired index and get its position\n * 4. insert a new table_cell or table_header node before/after the found position\n */\nfunction insertTableColumnCommand(\n    before,\n    state,\n    dispatch\n) {\n    // TODO: Cleanup\n    const schema = state.schema;\n\n    if (!inTable(state)) {\n        return false;\n    }\n    if (dispatch) {\n        const $head = state.selection.$head;\n        const selectedTable = $head.node(-3);\n        const selectedCellIndex = $head.index(-1);\n\n        // find and store all positions where we need to insert new cells\n        const newCells = [];\n        const tableOffset = $head.start(-3);\n        let targetCell;\n        // traverse the current table to find the absolute positions of our cells to be inserted\n        selectedTable.descendants((node, pos) => {\n            if (!tableNodes(schema).includes(node.type)) {\n                return false; // don't descend into non-table nodes\n            }\n\n            if (node.type === schema.nodes.table_row) {\n                targetCell = node.child(selectedCellIndex);\n            }\n\n            if (targetCell && node == targetCell) {\n                const position = before\n                    ? selectedTable.resolve(pos + 1).before()\n                    : selectedTable.resolve(pos + 1).after();\n                // position is relative to the start of the table, so we need\n                // to add the table offset (distance to start of document)\n                newCells.push([node.type, tableOffset + position]);\n            }\n        });\n\n        // insert new cells from bottom to top (reverse order)\n        // to avoid inserted cells making our found positions obsolete\n        let tr = state.tr;\n        for (const newCell of newCells.reverse()) {\n            tr = tr.insert(newCell[1], newCell[0].create());\n        }\n\n        dispatch(tr.scrollIntoView());\n    }\n    return true;\n}\n\nexport function removeRowCommand(\n    state,\n    dispatch\n) {\n    if (!inTable(state) || inTableHead(state)) {\n        return false;\n    }\n\n    if (dispatch) {\n        const tr = state.tr;\n        const $head = state.selection.$head;\n\n        // delete entire table if we're deleting the last row in the table body\n        if ($head.node(-2).childCount === 1) {\n            return removeTableCommand(state, dispatch);\n        }\n        // delete from start to end of this row (node at -1 position from the table cell)\n        tr.delete($head.start(-1) - 1, $head.end(-1) + 1);\n        dispatch(tr.scrollIntoView());\n    }\n\n    return true;\n}\n\nexport function removeColumnCommand(\n    state,\n    dispatch\n) {\n    // TODO: Cleanup\n    const schema = state.schema;\n\n    if (!inTable(state)) {\n        return false;\n    }\n\n    if (dispatch) {\n        const $head = state.selection.$head;\n        const table = $head.node(-3);\n\n        // remove entire table if this is the last remaining column\n        if ($head.node(-1).childCount === 1) {\n            return removeTableCommand(state, dispatch);\n        }\n\n        const cellIndex = $head.index(-1);\n        let targetCell;\n        const resolvedPositions = [];\n        const tableOffset = $head.start(-3);\n        table.descendants((node, pos) => {\n            if (!tableNodes(schema).includes(node.type)) {\n                return false; // don't descend into non-table nodes\n            }\n\n            if (node.type === schema.nodes.table_row) {\n                targetCell =\n                    node.childCount >= cellIndex + 1\n                        ? node.child(cellIndex)\n                        : null;\n            }\n\n            if (targetCell && node == targetCell) {\n                resolvedPositions.push(table.resolve(pos + 1));\n            }\n        });\n\n        let tr = state.tr;\n        for (const cellPosition of resolvedPositions.reverse()) {\n            tr = tr.delete(\n                tableOffset + cellPosition.start() - 1,\n                tableOffset + cellPosition.end() + 1\n            );\n        }\n\n        dispatch(tr.scrollIntoView());\n    }\n\n    return true;\n}\n\nexport function removeTableContentCommand(\n    state,\n    dispatch\n) {\n    if (!inTable(state)) {\n        return false;\n    }\n\n    const { $from, $to } = state.selection;\n\n    // selection includes entire table\n    if ($from.start(-3) >= $from.pos - 3 && $from.end(-3) <= $to.pos + 3) {\n        return removeTableCommand(state, dispatch);\n    }\n\n    // selection includes entire row\n    if ($from.start(-1) >= $from.pos - 1 && $from.end(-1) <= $to.pos + 1) {\n        return removeRowCommand(state, dispatch);\n    }\n\n    // selection contains two arbitrary cells?\n    // prevent delete operation to prevent deleting the cell nodes\n    // themselves and breaking the table structure\n    if (!$from.sameParent($to)) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction moveToCellCommand(\n    state,\n    dispatch,\n    direction\n) {\n    if (direction !== -1 && direction !== 1) {\n        return false;\n    }\n\n    if (!inTable(state)) return false;\n\n    const $head = state.selection.$head;\n\n    for (let level = -1; level > -4; level--) {\n        const parentIndex = $head.index(level);\n        const parent = $head.node(level);\n\n        if (!parent) continue;\n\n        // every time we want to skip the boundaries of a node (a cell, a row, ...)\n        // we have to consider the node's opening and closing positions, too. For\n        // each level, this will add an additional offset of 2 that we need to skip\n        const nodeOffset = 2;\n\n        const target = parent.maybeChild(parentIndex + direction);\n\n        if (!target) continue;\n\n        const newPos =\n            direction === -1\n                ? $head.start() - nodeOffset * (level * -1)\n                : $head.end() + nodeOffset * (level * -1);\n\n        dispatch(\n            state.tr\n                .setSelection(require('@askvortsov-rich-text').Selection.near(state.tr.doc.resolve(newPos), 1))\n                .scrollIntoView()\n        );\n\n        return true;\n    }\n\n    // we're at the end of the table and still want to move forward?\n    // let's move the cursor below the table!\n    if (direction === 1) {\n        return moveSelectionAfterTableCommand(state, dispatch);\n    } else {\n        return moveSelectionBeforeTableCommand(state, dispatch);\n    }\n}\n\nexport function moveToPreviousCellCommand(\n    state,\n    dispatch\n) {\n    return moveToCellCommand(state, dispatch, -1);\n}\n\nexport function moveToNextCellCommand(\n    state,\n    dispatch\n) {\n    return moveToCellCommand(state, dispatch, +1);\n}\n\nfunction removeTableCommand(\n    state,\n    dispatch\n) {\n    const $head = state.selection.$head;\n    if (dispatch) {\n        dispatch(state.tr.deleteRange($head.start(-3) - 1, $head.end(-3) + 1));\n    }\n\n    return true;\n}\n\nexport function insertTableCommand(numRows = 4, numCols = 3, labelCells = true) {\n    return (state, dispatch) => {\n        // TODO: Clean this up\n        const schema = state.schema;\n\n        // TODO: Reenable this\n        // if (!setBlockType(schema.nodes.table)(state)) {\n        //     return false;\n        // }\n\n        if (!dispatch) return true;\n\n        let headerIndex = 1;\n        let cellIndex = 1;\n        const cell = () =>\n            schema.nodes.table_cell.create(\n                null,\n                schema.text(labelCells ? `cell ${cellIndex++}` : ' ')\n            );\n        const header = () =>\n            schema.nodes.table_header.create(\n                null,\n                schema.text(labelCells ?`header ${headerIndex++}`: ' ')\n            );\n        const row = (...cells) =>\n            schema.nodes.table_row.create(null, cells);\n        const head = (row) =>\n            schema.nodes.table_head.create(null, row);\n        const body = (...rows) =>\n            schema.nodes.table_body.create(null, rows);\n        const table = (head, body) =>\n            schema.nodes.table.createChecked(null, [head, body]);\n        const paragraph = () => schema.nodes.paragraph.create(null);\n\n        // !MODIFIED\n        const t = table(\n            head(row(...Array(numCols).fill(0).map(header))),\n            body(\n                ...Array(numRows - 1).fill(0).map(_ => {\n                    return row(...Array(numCols).fill(0).map(cell))\n                })\n            )\n        );\n        // !MODIFIED\n\n        let tr = state.tr.replaceSelectionWith(t);\n        dispatch(tr.scrollIntoView());\n\n        // if there's no selectable node after the inserted table, insert an empty paragraph\n        // because it makes selecting, navigating much more intuitive\n        const newState = state.apply(tr);\n        const nodeAfterTable = newState.doc.nodeAt(newState.tr.selection.to - 1);\n        if (nodeAfterTable && nodeAfterTable.type === schema.nodes.text) {\n            tr = newState.tr.insert(newState.tr.selection.to, paragraph());\n            dispatch(tr.scrollIntoView());\n        }\n\n        return true;\n    }\n}","import Button from 'flarum/common/components/Button';\nimport Switch from 'flarum/common/components/Switch';\nimport listItems from 'flarum/common/helpers/listItems';\nimport extractText from 'flarum/common/utils/extractText';\nimport Stream from 'flarum/common/utils/Stream';\nimport { insertTableColumnAfterCommand, insertTableColumnBeforeCommand, insertTableCommand, insertTableRowBeforeCommand, insertTableRowAfterCommand, inTable, removeColumnCommand, removeRowCommand } from '../proseMirror/commands';\n\nexport default function TableDropdown() {\n  const FormDropdown = require('@askvortsov-rich-text').components.FormDropdown;\n  class TableDropdown extends FormDropdown {\n    oninit(vnode) {\n      super.oninit(vnode);\n\n      this.state = this.attrs.state;\n      this.state.addItem(\n        this.attrs.type,\n        (state, dispatch) => {\n          return this.command(state, dispatch);\n        },\n        this.onEditorUpdate.bind(this)\n      );\n\n      this.numCols = Stream(3);\n      this.numRows = Stream(4);\n      this.labelCells = Stream(true);\n    }\n\n    getMenu(items) {\n      if (!this.inTable()) {\n        return super.getMenu(items);\n      }\n\n      const commands = [\n        {\n          translation: 'remove_column',\n          command: removeColumnCommand\n        },\n        {\n          translation: 'insert_column_before',\n          command: insertTableColumnBeforeCommand\n        },\n        {\n          translation: 'insert_column_after',\n          command: insertTableColumnAfterCommand\n        },\n        {\n          translation: 'remove_row',\n          command: removeRowCommand\n        },\n        {\n          translation: 'insert_row_before',\n          command: insertTableRowBeforeCommand\n        },\n        {\n          translation: 'insert_row_after',\n          command: insertTableRowAfterCommand\n        },\n      ];\n\n      return (\n        <ul className={'Dropdown-menu dropdown-menu TableDropdownMenu'}>\n          {listItems(commands.map(command => <Button\n            onclick={this.click.bind(this, command.command)}\n            onkeydown={this.keydown.bind(this, command.command)}>\n            {app.translator.trans(`askvortsov-pipetables.forum.composer.table_menu.${command.translation}`)}\n          </Button>))}\n        </ul>\n      );\n    }\n\n    fields() {\n      const items = super.fields();\n\n      items.add(\n        'numCols',\n        <div className=\"Form-group\">\n          <label>{app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_cols')}</label>\n          <input\n            className=\"FormControl\"\n            name=\"numCols\"\n            type=\"number\"\n            placeholder={extractText(app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_cols'))}\n            bidi={this.numCols}\n            required\n          />\n        </div>,\n        10\n      );\n\n      items.add(\n        'numRows',\n        <div className=\"Form-group\">\n          <label>{app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_rows')}</label>\n          <input\n            className=\"FormControl\"\n            name=\"numRows\"\n            type=\"number\"\n            placeholder={extractText(app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_rows'))}\n            bidi={this.numRows}\n            required\n          />\n        </div>,\n        10\n      );\n\n      items.add(\n        'labelCells',\n\n        <div className=\"Form-group\">\n          {Switch.component({\n            state: this.labelCells(),\n            onchange: this.labelCells\n          }, app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.label_cells'))}\n        </div>,\n        9\n      )\n\n\n      return items;\n    }\n\n    inTable() {\n      return inTable(this.attrs.state.editorView.state);\n    }\n\n    onEditorUpdate() {\n      this.currInTable = this.inTable();\n    }\n\n    keydown(command, e) {\n      if (e.key === ' ' || e.key === 'Enter') {\n        this.click(command, e);\n      }\n    }\n\n    click(command, e) {\n      e.preventDefault();\n      this.command = command;\n      return this.state.run(this.attrs.type);\n    }\n\n    insert() {\n      if (!this.inTable()) {\n        this.command = insertTableCommand(parseInt(this.numRows()), parseInt(this.numCols()), this.labelCells());\n        this.state.run(this.attrs.type);\n      }\n    }\n  }\n\n  return TableDropdown;\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import { moveSelectionAfterTableCommand, moveToNextCellCommand, moveToPreviousCellCommand, removeTableContentCommand } from \"./commands\";\n\nexport const tableKeymap = {\n    \"Mod-Enter\": moveSelectionAfterTableCommand,\n    \"Shift-Enter\": moveSelectionAfterTableCommand,\n    \"Enter\": moveToNextCellCommand,\n    \"Backspace\": removeTableContentCommand,\n    \"Delete\": removeTableContentCommand,\n    \"Mod-Backspace\": removeTableContentCommand,\n    \"Mod-Delete\": removeTableContentCommand,\n    \"Tab\": moveToNextCellCommand,\n    \"Shift-Tab\": moveToPreviousCellCommand,\n};","export const tableNodeSpec = {\n    content: \"table_head table_body*\",\n    isolating: true,\n    group: \"block\",\n    selectable: false,\n    parseDOM: [{ tag: \"table\" }],\n    toDOM() {\n        return [\n            \"div\",\n            { class: \"s-table-container\" },\n            [\"table\", { class: \"s-table\" }, 0],\n        ];\n    },\n};\n\nexport const tableHeadNodeSpec = {\n    content: \"table_row\",\n    isolating: true,\n    group: \"table_block\",\n    selectable: false,\n    parseDOM: [{ tag: \"thead\" }],\n    toDOM() {\n        return [\"thead\", 0];\n    },\n};\n\nexport const tableBodyNodeSpec = {\n    content: \"table_row+\",\n    isolating: true,\n    group: \"table_block\",\n    selectable: false,\n    parseDOM: [{ tag: \"tbody\" }],\n    toDOM() {\n        return [\"tbody\", 0];\n    },\n};\n\nexport const tableRowNodeSpec = {\n    content: \"(table_cell | table_header)+\",\n    isolating: true,\n    group: \"table_block\",\n    selectable: false,\n    parseDOM: [{ tag: \"tr\" }],\n    toDOM() {\n        return [\"tr\", 0];\n    },\n};\n\nexport const tableCellNodeSpec = {\n    content: \"inline*\",\n    isolating: true,\n    group: \"table_block\",\n    selectable: false,\n    attrs: {\n        style: { default: null },\n    },\n    parseDOM: [\n        {\n            tag: \"td\",\n            getAttrs(dom) {\n                const textAlign = dom.style.textAlign;\n                return textAlign ? { style: `text-align: ${textAlign}` } : null;\n            },\n        },\n    ],\n    toDOM(node) {\n        return [\"td\", node.attrs, 0];\n    },\n};\n\nexport const tableHeaderNodeSpec = {\n    content: \"inline*\",\n    isolating: true,\n    group: \"table_block\",\n    selectable: false,\n    attrs: {\n        style: { default: null },\n    },\n    parseDOM: [\n        {\n            tag: \"th\",\n            getAttrs(dom) {\n                const textAlign = dom.style.textAlign;\n                return textAlign ? { style: `text-align: ${textAlign}` } : null;\n            },\n        },\n    ],\n    toDOM(node) {\n        return [\"th\", node.attrs, 0];\n    },\n};\n","import { extend, override } from 'flarum/extend';\nimport TableDropdown from './components/TableDropdown';\nimport { tableKeymap } from './proseMirror/tableKeymap';\nimport { tableBodyNodeSpec, tableCellNodeSpec, tableHeaderNodeSpec, tableHeadNodeSpec, tableNodeSpec, tableRowNodeSpec } from './proseMirror/tableSchema';\n\nexport default function configureRichText() {\n    if (!(\"askvortsov-rich-text\" in flarum.extensions)) return;\n\n    const ProseMirrorMenu = require('@askvortsov-rich-text').components.ProseMirrorMenu;\n\n    const TableDropdownComponent = TableDropdown();\n\n    extend(ProseMirrorMenu.prototype, 'items', function (items) {\n        items.add('table', TableDropdownComponent.component({\n            type: 'table',\n            icon: 'fas fa-table',\n            tooltip: app.translator.trans('askvortsov-pipetables.forum.composer.table_tooltip'),\n            state: this.attrs.state\n        }), 10);\n    });\n\n    const MarkdownSerializerBuilder = require('@askvortsov-rich-text').proseMirror.markdown.MarkdownSerializerBuilder;\n\n    extend(MarkdownSerializerBuilder.prototype, 'buildNodes', function (nodes) {\n        const richTextSchema = this.schema;\n        nodes.table = function table(state, node) {\n            function serializeTableHead(head) {\n                let columnAlignments = [];\n                head.forEach((headRow) => {\n                    if (headRow.type === richTextSchema.nodes.table_row) {\n                        columnAlignments = serializeTableRow(headRow);\n                    }\n                });\n\n                // write table header separator\n                for (const alignment of columnAlignments) {\n                    state.write(\"|\");\n\n                    state.write(\n                        alignment === \"left\" || alignment === \"center\" ? \":\" : \" \"\n                    );\n                    state.write(\"---\");\n                    state.write(\n                        alignment === \"right\" || alignment === \"center\" ? \":\" : \" \"\n                    );\n                }\n                state.write(\"|\");\n                state.ensureNewLine();\n            }\n\n            function serializeTableBody(body) {\n                body.forEach((bodyRow) => {\n                    if (bodyRow.type === richTextSchema.nodes.table_row) {\n                        serializeTableRow(bodyRow);\n                    }\n                });\n                state.ensureNewLine();\n            }\n\n            function serializeTableRow(row) {\n                const columnAlignment = [];\n                row.forEach((cell) => {\n                    if (\n                        cell.type === richTextSchema.nodes.table_header ||\n                        cell.type === richTextSchema.nodes.table_cell\n                    ) {\n                        const alignment = serializeTableCell(cell);\n                        columnAlignment.push(alignment);\n                    }\n                });\n                state.write(\"|\");\n                state.ensureNewLine();\n                return columnAlignment;\n            }\n\n            function serializeTableCell(cell) {\n                state.write(\"| \");\n                state.renderInline(cell);\n                state.write(\" \");\n\n                return findAlignment(cell);\n            }\n\n            function findAlignment(cell) {\n                const alignment = cell.attrs.style;\n                if (!alignment) {\n                    return null;\n                }\n\n                // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n                const match = alignment.match(/text-align:[ ]?(left|right|center)/);\n\n                if (match && match[1]) {\n                    return match[1];\n                }\n\n                return null;\n            }\n\n            // TODO: don't rely on node names\n            node.forEach((table_child) => {\n                if (table_child.type.name === 'table_head')\n                    serializeTableHead(table_child);\n                if (table_child.type.name === 'table_body')\n                    serializeTableBody(table_child);\n            });\n\n            state.ensureNewLine();\n            state.write(\"\\n\");\n        };\n    });\n\n    const MarkdownParserBuilder = require('@askvortsov-rich-text').proseMirror.markdown.MarkdownParserBuilder;\n\n    extend(MarkdownParserBuilder.prototype, 'buildTokens', function (tokens) {\n        Object.assign(tokens, {\n            table: {\n                block: \"table\",\n            },\n\n            thead: {\n                block: \"table_head\",\n            },\n\n            tbody: {\n                block: \"table_body\",\n            },\n\n            th: {\n                block: \"table_header\",\n                getAttrs: (tok) => ({\n                    style: tok.attrGet(\"style\"),\n                }),\n            },\n\n            tr: {\n                block: \"table_row\",\n            },\n\n            td: {\n                block: \"table_cell\",\n                getAttrs: (tok) => ({\n                    style: tok.attrGet(\"style\"),\n                }),\n            },\n        });\n    });\n\n    extend(MarkdownParserBuilder.prototype, 'buildTokenizer', function (tokenizer) {\n        tokenizer.enable('table');\n    });\n\n    const SchemaBuilder = require('@askvortsov-rich-text').proseMirror.markdown.SchemaBuilder;\n\n    override(SchemaBuilder.prototype, 'buildNodes', function (original) {\n        const nodes = original();\n\n        return nodes\n            .addBefore(\"image\", \"table\", tableNodeSpec)\n            .addBefore(\"image\", \"table_head\", tableHeadNodeSpec)\n            .addBefore(\"image\", \"table_body\", tableBodyNodeSpec)\n            .addBefore(\"image\", \"table_row\", tableRowNodeSpec)\n            .addBefore(\"image\", \"table_cell\", tableCellNodeSpec)\n            .addBefore(\"image\", \"table_header\", tableHeaderNodeSpec);\n    });\n\n    const ProseMirrorEditorDriver = require('@askvortsov-rich-text').proseMirror.ProseMirrorEditorDriver;\n\n    extend(ProseMirrorEditorDriver.prototype, 'buildPluginItems', function (items) {\n        items.add('tableKeymap', require('@askvortsov-rich-text').keymap(tableKeymap), 10)\n    });\n}","import app from 'flarum/app';\nimport { extend } from 'flarum/extend'\nimport Post from 'flarum/components/Post'\nimport configureRichText from './configureRichText';\n\napp.initializers.add('askvortsov-pipetables', () => {\n\textend(Post.prototype, 'oncreate', function () {\n\t\tfunction addDataLabelsToTable(table) {\n\t\t\tlet labels = [];\n\t\t\tfor (let th of table.getElementsByTagName('th')) {\n\t\t\t\tlabels.push(th.textContent);\n\t\t\t}\n\t\t\tfor (let tr of table.getElementsByTagName('tr')) {\n\t\t\t\tlet i = -1;\n\t\t\t\tfor (let td of tr.getElementsByTagName('td')) {\n\t\t\t\t\ttd.setAttribute('data-label', labels[++i] || '');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let table of document.getElementsByTagName('table')) {\n\t\t\taddDataLabelsToTable(table);\n\t\t}\n\t});\n\n\tif ('askvortsov-rich-text' in flarum.extensions) {\n\t\tconfigureRichText();\n\t}\n});\n"],"sourceRoot":""}