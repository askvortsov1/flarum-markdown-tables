{"version":3,"sources":["webpack://@askvortsov/flarum-markdown-tables/webpack/bootstrap","webpack://@askvortsov/flarum-markdown-tables/./forum.js","webpack://@askvortsov/flarum-markdown-tables/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@askvortsov/flarum-markdown-tables/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/components/TableDropdown.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/configureRichText.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/index.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/proseMirror/commands.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/proseMirror/tableKeymap.js","webpack://@askvortsov/flarum-markdown-tables/./src/forum/proseMirror/tableSchema.js","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.extensions['askvortsov-rich-text']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['app']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/components/Button']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/components/Separator']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/components/Switch']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/helpers/listItems']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/utils/Stream']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['common/utils/extractText']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['components/Post']\"","webpack://@askvortsov/flarum-markdown-tables/external \"flarum.core.compat['extend']\""],"names":["TableDropdown","FormDropdown","require","components","oninit","vnode","state","attrs","addItem","type","dispatch","command","onEditorUpdate","bind","numCols","Stream","numRows","labelCells","getMenu","items","inTable","commandsToButtons","commands","map","click","keydown","app","translator","trans","translation","colCommands","removeColumnCommand","insertTableColumnBeforeCommand","insertTableColumnAfterCommand","rowCommands","removeRowCommand","insertTableRowBeforeCommand","insertTableRowAfterCommand","listItems","Separator","component","fields","add","extractText","Switch","onchange","editorView","currInTable","e","key","preventDefault","run","insert","insertTableCommand","parseInt","active","$","toggleClass","configureRichText","flarum","extensions","ProseMirrorMenu","TableDropdownComponent","extend","prototype","icon","tooltip","MarkdownSerializerBuilder","proseMirror","markdown","nodes","richTextSchema","schema","table","node","serializeTableHead","head","columnAlignments","forEach","headRow","table_row","serializeTableRow","alignment","write","ensureNewLine","serializeTableBody","body","bodyRow","row","columnAlignment","cell","table_header","table_cell","serializeTableCell","push","renderInline","findAlignment","style","match","table_child","name","MarkdownParserBuilder","tokens","block","thead","tbody","th","getAttrs","tok","attrGet","tr","td","tokenizer","enable","SchemaBuilder","override","original","addBefore","tableNodeSpec","tableHeadNodeSpec","tableBodyNodeSpec","tableRowNodeSpec","tableCellNodeSpec","tableHeaderNodeSpec","ProseMirrorEditorDriver","keymap","tableKeymap","initializers","Post","addDataLabelsToTable","labels","getElementsByTagName","textContent","i","setAttribute","document","tableNodes","table_head","table_body","includes","selection","$head","parent","inTableHead","moveSelectionAfterTableCommand","exitTableCommand","moveSelectionBeforeTableCommand","before","paragraph","newPosition","after","doc","resolve","insertionPosition","create","setSelection","Selection","near","Math","max","scrollIntoView","insertTableRowCommand","tableRowNode","newTableCells","newTableRow","positionToInsert","insertTableColumnCommand","selectedTable","selectedCellIndex","index","newCells","tableOffset","start","targetCell","descendants","pos","child","position","reverse","newCell","childCount","removeTableCommand","delete","end","cellIndex","resolvedPositions","cellPosition","removeTableContentCommand","$from","$to","sameParent","moveToCellCommand","direction","level","parentIndex","nodeOffset","target","maybeChild","newPos","moveToPreviousCellCommand","moveToNextCellCommand","deleteRange","headerIndex","text","header","cells","rows","createChecked","t","Array","fill","_","replaceSelectionWith","newState","apply","nodeAfterTable","nodeAt","to","Enter","Backspace","Delete","Tab","content","isolating","group","selectable","parseDOM","tag","toDOM","class","default","dom","textAlign"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Button from 'flarum/common/components/Button';\nimport Separator from 'flarum/common/components/Separator';\nimport Switch from 'flarum/common/components/Switch';\nimport listItems from 'flarum/common/helpers/listItems';\nimport extractText from 'flarum/common/utils/extractText';\nimport Stream from 'flarum/common/utils/Stream';\nimport {\n  insertTableColumnAfterCommand,\n  insertTableColumnBeforeCommand,\n  insertTableCommand,\n  insertTableRowBeforeCommand,\n  insertTableRowAfterCommand,\n  inTable,\n  removeColumnCommand,\n  removeRowCommand,\n} from '../proseMirror/commands';\n\nexport default function TableDropdown() {\n  const FormDropdown = require('@askvortsov-rich-text').components.FormDropdown;\n  class TableDropdown extends FormDropdown {\n    oninit(vnode) {\n      super.oninit(vnode);\n\n      this.state = this.attrs.state;\n      this.state.addItem(\n        this.attrs.type,\n        (state, dispatch) => {\n          return this.command(state, dispatch);\n        },\n        this.onEditorUpdate.bind(this)\n      );\n\n      this.numCols = Stream(3);\n      this.numRows = Stream(4);\n      this.labelCells = Stream(true);\n    }\n\n    getMenu(items) {\n      if (!this.inTable()) {\n        return super.getMenu(items);\n      }\n\n      const commandsToButtons = commands => {\n        return commands.map((command) => (\n          <Button onclick={this.click.bind(this, command.command)} onkeydown={this.keydown.bind(this, command.command)}>\n            {app.translator.trans(`askvortsov-pipetables.forum.composer.table_menu.${command.translation}`)}\n          </Button>\n        ));\n      }\n\n      const colCommands = [\n        {\n          translation: 'remove_column',\n          command: removeColumnCommand,\n        },\n        {\n          translation: 'insert_column_before',\n          command: insertTableColumnBeforeCommand,\n        },\n        {\n          translation: 'insert_column_after',\n          command: insertTableColumnAfterCommand,\n        }\n      ];\n\n      const rowCommands = [\n        {\n          translation: 'remove_row',\n          command: removeRowCommand,\n        },\n        {\n          translation: 'insert_row_before',\n          command: insertTableRowBeforeCommand,\n        },\n        {\n          translation: 'insert_row_after',\n          command: insertTableRowAfterCommand,\n        }\n      ];\n\n      return (\n        <ul className={'Dropdown-menu dropdown-menu TableDropdownMenu'}>\n          {listItems([\n            ...commandsToButtons(colCommands),\n            Separator.component(),\n            ...commandsToButtons(rowCommands)\n          ])}\n        </ul>\n      );\n    }\n\n    fields() {\n      const items = super.fields();\n\n      items.add(\n        'numCols',\n        <div className=\"Form-group\">\n          <label>{app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_cols')}</label>\n          <input\n            className=\"FormControl\"\n            name=\"numCols\"\n            type=\"number\"\n            placeholder={extractText(app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_cols'))}\n            bidi={this.numCols}\n            required\n          />\n        </div>,\n        10\n      );\n\n      items.add(\n        'numRows',\n        <div className=\"Form-group\">\n          <label>{app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_rows')}</label>\n          <input\n            className=\"FormControl\"\n            name=\"numRows\"\n            type=\"number\"\n            placeholder={extractText(app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.num_rows'))}\n            bidi={this.numRows}\n            required\n          />\n        </div>,\n        10\n      );\n\n      items.add(\n        'labelCells',\n\n        <div className=\"Form-group\">\n          {Switch.component(\n            {\n              state: this.labelCells(),\n              onchange: this.labelCells,\n            },\n            app.translator.trans('askvortsov-pipetables.forum.composer.table_menu.label_cells')\n          )}\n        </div>,\n        9\n      );\n\n      return items;\n    }\n\n    inTable() {\n      return inTable(this.attrs.state.editorView.state);\n    }\n\n    onEditorUpdate() {\n      this.currInTable = this.inTable();\n    }\n\n    keydown(command, e) {\n      if (e.key === ' ' || e.key === 'Enter') {\n        this.click(command, e);\n      }\n    }\n\n    click(command, e) {\n      e.preventDefault();\n      this.command = command;\n      return this.state.run(this.attrs.type);\n    }\n\n    insert() {\n      if (!this.inTable()) {\n        this.command = insertTableCommand(parseInt(this.numRows()), parseInt(this.numCols()), this.labelCells());\n        this.state.run(this.attrs.type);\n      }\n    }\n\n    onEditorUpdate() {\n      this.active = !!this.inTable();\n      this.$('.Dropdown-toggle').toggleClass('active', this.active);\n    }\n  }\n\n  return TableDropdown;\n}\n","import { extend, override } from 'flarum/extend';\nimport TableDropdown from './components/TableDropdown';\nimport { tableKeymap } from './proseMirror/tableKeymap';\nimport {\n  tableBodyNodeSpec,\n  tableCellNodeSpec,\n  tableHeaderNodeSpec,\n  tableHeadNodeSpec,\n  tableNodeSpec,\n  tableRowNodeSpec,\n} from './proseMirror/tableSchema';\n\nexport default function configureRichText() {\n  if (!('askvortsov-rich-text' in flarum.extensions)) return;\n\n  const ProseMirrorMenu = require('@askvortsov-rich-text').components.ProseMirrorMenu;\n\n  const TableDropdownComponent = TableDropdown();\n\n  extend(ProseMirrorMenu.prototype, 'items', function (items) {\n    items.add(\n      'table',\n      TableDropdownComponent.component({\n        type: 'table',\n        icon: 'fas fa-table',\n        tooltip: app.translator.trans('askvortsov-pipetables.forum.composer.table_tooltip'),\n        state: this.attrs.state,\n      }),\n      10\n    );\n  });\n\n  const MarkdownSerializerBuilder = require('@askvortsov-rich-text').proseMirror.markdown.MarkdownSerializerBuilder;\n\n  extend(MarkdownSerializerBuilder.prototype, 'buildNodes', function (nodes) {\n    const richTextSchema = this.schema;\n    nodes.table = function table(state, node) {\n      function serializeTableHead(head) {\n        let columnAlignments = [];\n        head.forEach((headRow) => {\n          if (headRow.type === richTextSchema.nodes.table_row) {\n            columnAlignments = serializeTableRow(headRow);\n          }\n        });\n\n        // write table header separator\n        for (const alignment of columnAlignments) {\n          state.write('|');\n\n          state.write(alignment === 'left' || alignment === 'center' ? ':' : ' ');\n          state.write('---');\n          state.write(alignment === 'right' || alignment === 'center' ? ':' : ' ');\n        }\n        state.write('|');\n        state.ensureNewLine();\n      }\n\n      function serializeTableBody(body) {\n        body.forEach((bodyRow) => {\n          if (bodyRow.type === richTextSchema.nodes.table_row) {\n            serializeTableRow(bodyRow);\n          }\n        });\n        state.ensureNewLine();\n      }\n\n      function serializeTableRow(row) {\n        const columnAlignment = [];\n        row.forEach((cell) => {\n          if (cell.type === richTextSchema.nodes.table_header || cell.type === richTextSchema.nodes.table_cell) {\n            const alignment = serializeTableCell(cell);\n            columnAlignment.push(alignment);\n          }\n        });\n        state.write('|');\n        state.ensureNewLine();\n        return columnAlignment;\n      }\n\n      function serializeTableCell(cell) {\n        state.write('| ');\n        state.renderInline(cell);\n        state.write(' ');\n\n        return findAlignment(cell);\n      }\n\n      function findAlignment(cell) {\n        const alignment = cell.attrs.style;\n        if (!alignment) {\n          return null;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n        const match = alignment.match(/text-align:[ ]?(left|right|center)/);\n\n        if (match && match[1]) {\n          return match[1];\n        }\n\n        return null;\n      }\n\n      // TODO: don't rely on node names\n      node.forEach((table_child) => {\n        if (table_child.type.name === 'table_head') serializeTableHead(table_child);\n        if (table_child.type.name === 'table_body') serializeTableBody(table_child);\n      });\n\n      state.ensureNewLine();\n      state.write('\\n');\n    };\n  });\n\n  const MarkdownParserBuilder = require('@askvortsov-rich-text').proseMirror.markdown.MarkdownParserBuilder;\n\n  extend(MarkdownParserBuilder.prototype, 'buildTokens', function (tokens) {\n    Object.assign(tokens, {\n      table: {\n        block: 'table',\n      },\n\n      thead: {\n        block: 'table_head',\n      },\n\n      tbody: {\n        block: 'table_body',\n      },\n\n      th: {\n        block: 'table_header',\n        getAttrs: (tok) => ({\n          style: tok.attrGet('style'),\n        }),\n      },\n\n      tr: {\n        block: 'table_row',\n      },\n\n      td: {\n        block: 'table_cell',\n        getAttrs: (tok) => ({\n          style: tok.attrGet('style'),\n        }),\n      },\n    });\n  });\n\n  extend(MarkdownParserBuilder.prototype, 'buildTokenizer', function (tokenizer) {\n    tokenizer.enable('table');\n  });\n\n  const SchemaBuilder = require('@askvortsov-rich-text').proseMirror.markdown.SchemaBuilder;\n\n  override(SchemaBuilder.prototype, 'buildNodes', function (original) {\n    const nodes = original();\n\n    return nodes\n      .addBefore('image', 'table', tableNodeSpec)\n      .addBefore('image', 'table_head', tableHeadNodeSpec)\n      .addBefore('image', 'table_body', tableBodyNodeSpec)\n      .addBefore('image', 'table_row', tableRowNodeSpec)\n      .addBefore('image', 'table_cell', tableCellNodeSpec)\n      .addBefore('image', 'table_header', tableHeaderNodeSpec);\n  });\n\n  const ProseMirrorEditorDriver = require('@askvortsov-rich-text').proseMirror.ProseMirrorEditorDriver;\n\n  extend(ProseMirrorEditorDriver.prototype, 'buildPluginItems', function (items) {\n    items.add('tableKeymap', require('@askvortsov-rich-text').keymap(tableKeymap), 10);\n  });\n}\n","import app from 'flarum/app';\nimport { extend } from 'flarum/extend';\nimport Post from 'flarum/components/Post';\nimport configureRichText from './configureRichText';\n\napp.initializers.add('askvortsov-pipetables', () => {\n  extend(Post.prototype, 'oncreate', function () {\n    function addDataLabelsToTable(table) {\n      let labels = [];\n      for (let th of table.getElementsByTagName('th')) {\n        labels.push(th.textContent);\n      }\n      for (let tr of table.getElementsByTagName('tr')) {\n        let i = -1;\n        for (let td of tr.getElementsByTagName('td')) {\n          td.setAttribute('data-label', labels[++i] || '');\n        }\n      }\n    }\n    for (let table of document.getElementsByTagName('table')) {\n      addDataLabelsToTable(table);\n    }\n  });\n\n  if ('askvortsov-rich-text' in flarum.extensions) {\n    configureRichText();\n  }\n});\n","function tableNodes(schema) {\n  return [\n    schema.nodes.table,\n    schema.nodes.table_head,\n    schema.nodes.table_body,\n    schema.nodes.table_row,\n    schema.nodes.table_cell,\n    schema.nodes.table_header,\n  ];\n}\n\nexport function inTable(state) {\n  return tableNodes(state.schema).includes(state.selection.$head.parent.type);\n}\n\nfunction inTableHead(state) {\n  return state.selection.$head.parent.type === state.schema.nodes.table_header;\n}\n\nexport function moveSelectionAfterTableCommand(state, dispatch) {\n  return exitTableCommand(state, dispatch, false);\n}\n\nexport function moveSelectionBeforeTableCommand(state, dispatch) {\n  return exitTableCommand(state, dispatch, true);\n}\n\nfunction exitTableCommand(state, dispatch, before = false) {\n  // TODO: Cleanup\n  const schema = state.schema;\n\n  if (!inTable(state)) {\n    return false;\n  }\n\n  if (dispatch) {\n    // our hierarchy is table > table_head | table_body > table_row > table_cell\n    // and we're relying on that to be always true.\n    // That's why .after(-3) selects the parent _table_ node from a table_cell node\n    const type = schema.nodes.paragraph;\n    const newPosition = before ? state.selection.$head.before(-3) - 1 : state.selection.$head.after(-3) + 1;\n    const tr = state.tr;\n\n    // if the position before/after the table doesn't exist, let's insert a paragraph there\n    try {\n      tr.doc.resolve(newPosition);\n    } catch (e) {\n      const insertionPosition = before ? newPosition + 1 : newPosition - 1;\n      tr.insert(insertionPosition, type.create());\n    }\n\n    tr.setSelection(require('@askvortsov-rich-text').Selection.near(tr.doc.resolve(Math.max(0, newPosition)), 1));\n    dispatch(tr.scrollIntoView());\n  }\n  return true;\n}\n\nexport function insertTableRowBeforeCommand(state, dispatch) {\n  return insertTableRowCommand(true, state, dispatch);\n}\n\nexport function insertTableRowAfterCommand(state, dispatch) {\n  return insertTableRowCommand(false, state, dispatch);\n}\n\nfunction insertTableRowCommand(before, state, dispatch) {\n  // TODO: Cleanup\n  const schema = state.schema;\n\n  if (!inTable(state) || inTableHead(state)) {\n    return false;\n  }\n\n  if (dispatch) {\n    const { $head } = state.selection;\n    const tableRowNode = $head.node(-1);\n\n    const newTableCells = [];\n    tableRowNode.forEach((cell) => {\n      newTableCells.push(schema.nodes.table_cell.create(cell.attrs));\n    });\n    const newTableRow = schema.nodes.table_row.create(null, newTableCells);\n    const positionToInsert = before ? $head.before(-1) : $head.after(-1);\n    const tr = state.tr.insert(positionToInsert, newTableRow);\n\n    dispatch(tr.scrollIntoView());\n  }\n\n  return true;\n}\n\nexport function insertTableColumnAfterCommand(state, dispatch) {\n  return insertTableColumnCommand(false, state, dispatch);\n}\n\nexport function insertTableColumnBeforeCommand(state, dispatch) {\n  return insertTableColumnCommand(true, state, dispatch);\n}\n\n/**\n *  Insert a new table column in this table\n * 1. find the index of the selected table cell in the current table row\n * 2. walk through the entire document to traverse all rows in our selected table\n * 3. for each table row, find the table cell at the desired index and get its position\n * 4. insert a new table_cell or table_header node before/after the found position\n */\nfunction insertTableColumnCommand(before, state, dispatch) {\n  // TODO: Cleanup\n  const schema = state.schema;\n\n  if (!inTable(state)) {\n    return false;\n  }\n  if (dispatch) {\n    const $head = state.selection.$head;\n    const selectedTable = $head.node(-3);\n    const selectedCellIndex = $head.index(-1);\n\n    // find and store all positions where we need to insert new cells\n    const newCells = [];\n    const tableOffset = $head.start(-3);\n    let targetCell;\n    // traverse the current table to find the absolute positions of our cells to be inserted\n    selectedTable.descendants((node, pos) => {\n      if (!tableNodes(schema).includes(node.type)) {\n        return false; // don't descend into non-table nodes\n      }\n\n      if (node.type === schema.nodes.table_row) {\n        targetCell = node.child(selectedCellIndex);\n      }\n\n      if (targetCell && node == targetCell) {\n        const position = before ? selectedTable.resolve(pos + 1).before() : selectedTable.resolve(pos + 1).after();\n        // position is relative to the start of the table, so we need\n        // to add the table offset (distance to start of document)\n        newCells.push([node.type, tableOffset + position]);\n      }\n    });\n\n    // insert new cells from bottom to top (reverse order)\n    // to avoid inserted cells making our found positions obsolete\n    let tr = state.tr;\n    for (const newCell of newCells.reverse()) {\n      tr = tr.insert(newCell[1], newCell[0].create());\n    }\n\n    dispatch(tr.scrollIntoView());\n  }\n  return true;\n}\n\nexport function removeRowCommand(state, dispatch) {\n  if (!inTable(state) || inTableHead(state)) {\n    return false;\n  }\n\n  if (dispatch) {\n    const tr = state.tr;\n    const $head = state.selection.$head;\n\n    // delete entire table if we're deleting the last row in the table body\n    if ($head.node(-2).childCount === 1) {\n      return removeTableCommand(state, dispatch);\n    }\n    // delete from start to end of this row (node at -1 position from the table cell)\n    tr.delete($head.start(-1) - 1, $head.end(-1) + 1);\n    dispatch(tr.scrollIntoView());\n  }\n\n  return true;\n}\n\nexport function removeColumnCommand(state, dispatch) {\n  // TODO: Cleanup\n  const schema = state.schema;\n\n  if (!inTable(state)) {\n    return false;\n  }\n\n  if (dispatch) {\n    const $head = state.selection.$head;\n    const table = $head.node(-3);\n\n    // remove entire table if this is the last remaining column\n    if ($head.node(-1).childCount === 1) {\n      return removeTableCommand(state, dispatch);\n    }\n\n    const cellIndex = $head.index(-1);\n    let targetCell;\n    const resolvedPositions = [];\n    const tableOffset = $head.start(-3);\n    table.descendants((node, pos) => {\n      if (!tableNodes(schema).includes(node.type)) {\n        return false; // don't descend into non-table nodes\n      }\n\n      if (node.type === schema.nodes.table_row) {\n        targetCell = node.childCount >= cellIndex + 1 ? node.child(cellIndex) : null;\n      }\n\n      if (targetCell && node == targetCell) {\n        resolvedPositions.push(table.resolve(pos + 1));\n      }\n    });\n\n    let tr = state.tr;\n    for (const cellPosition of resolvedPositions.reverse()) {\n      tr = tr.delete(tableOffset + cellPosition.start() - 1, tableOffset + cellPosition.end() + 1);\n    }\n\n    dispatch(tr.scrollIntoView());\n  }\n\n  return true;\n}\n\nexport function removeTableContentCommand(state, dispatch) {\n  if (!inTable(state)) {\n    return false;\n  }\n\n  const { $from, $to } = state.selection;\n\n  // selection includes entire table\n  if ($from.start(-3) >= $from.pos - 3 && $from.end(-3) <= $to.pos + 3) {\n    return removeTableCommand(state, dispatch);\n  }\n\n  // selection includes entire row\n  if ($from.start(-1) >= $from.pos - 1 && $from.end(-1) <= $to.pos + 1) {\n    return removeRowCommand(state, dispatch);\n  }\n\n  // selection contains two arbitrary cells?\n  // prevent delete operation to prevent deleting the cell nodes\n  // themselves and breaking the table structure\n  if (!$from.sameParent($to)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction moveToCellCommand(state, dispatch, direction) {\n  if (direction !== -1 && direction !== 1) {\n    return false;\n  }\n\n  if (!inTable(state)) return false;\n\n  const $head = state.selection.$head;\n\n  for (let level = -1; level > -4; level--) {\n    const parentIndex = $head.index(level);\n    const parent = $head.node(level);\n\n    if (!parent) continue;\n\n    // every time we want to skip the boundaries of a node (a cell, a row, ...)\n    // we have to consider the node's opening and closing positions, too. For\n    // each level, this will add an additional offset of 2 that we need to skip\n    const nodeOffset = 2;\n\n    const target = parent.maybeChild(parentIndex + direction);\n\n    if (!target) continue;\n\n    const newPos = direction === -1 ? $head.start() - nodeOffset * (level * -1) : $head.end() + nodeOffset * (level * -1);\n\n    dispatch(state.tr.setSelection(require('@askvortsov-rich-text').Selection.near(state.tr.doc.resolve(newPos), 1)).scrollIntoView());\n\n    return true;\n  }\n\n  // we're at the end of the table and still want to move forward?\n  // let's move the cursor below the table!\n  if (direction === 1) {\n    return moveSelectionAfterTableCommand(state, dispatch);\n  } else {\n    return moveSelectionBeforeTableCommand(state, dispatch);\n  }\n}\n\nexport function moveToPreviousCellCommand(state, dispatch) {\n  return moveToCellCommand(state, dispatch, -1);\n}\n\nexport function moveToNextCellCommand(state, dispatch) {\n  return moveToCellCommand(state, dispatch, +1);\n}\n\nfunction removeTableCommand(state, dispatch) {\n  const $head = state.selection.$head;\n  if (dispatch) {\n    dispatch(state.tr.deleteRange($head.start(-3) - 1, $head.end(-3) + 1));\n  }\n\n  return true;\n}\n\nexport function insertTableCommand(numRows = 4, numCols = 3, labelCells = true) {\n  return (state, dispatch) => {\n    // TODO: Clean this up\n    const schema = state.schema;\n\n    // TODO: Reenable this\n    // if (!setBlockType(schema.nodes.table)(state)) {\n    //     return false;\n    // }\n\n    if (!dispatch) return true;\n\n    let headerIndex = 1;\n    let cellIndex = 1;\n    const cell = () => schema.nodes.table_cell.create(null, schema.text(labelCells ? `cell ${cellIndex++}` : ' '));\n    const header = () => schema.nodes.table_header.create(null, schema.text(labelCells ? `header ${headerIndex++}` : ' '));\n    const row = (...cells) => schema.nodes.table_row.create(null, cells);\n    const head = (row) => schema.nodes.table_head.create(null, row);\n    const body = (...rows) => schema.nodes.table_body.create(null, rows);\n    const table = (head, body) => schema.nodes.table.createChecked(null, [head, body]);\n    const paragraph = () => schema.nodes.paragraph.create(null);\n\n    // !MODIFIED\n    const t = table(\n      head(row(...Array(numCols).fill(0).map(header))),\n      body(\n        ...Array(numRows - 1)\n          .fill(0)\n          .map((_) => {\n            return row(...Array(numCols).fill(0).map(cell));\n          })\n      )\n    );\n    // !MODIFIED\n\n    let tr = state.tr.replaceSelectionWith(t);\n    dispatch(tr.scrollIntoView());\n\n    // if there's no selectable node after the inserted table, insert an empty paragraph\n    // because it makes selecting, navigating much more intuitive\n    const newState = state.apply(tr);\n    const nodeAfterTable = newState.doc.nodeAt(newState.tr.selection.to - 1);\n    if (nodeAfterTable && nodeAfterTable.type === schema.nodes.text) {\n      tr = newState.tr.insert(newState.tr.selection.to, paragraph());\n      dispatch(tr.scrollIntoView());\n    }\n\n    return true;\n  };\n}\n","import { moveSelectionAfterTableCommand, moveToNextCellCommand, moveToPreviousCellCommand, removeTableContentCommand } from './commands';\n\nexport const tableKeymap = {\n  'Mod-Enter': moveSelectionAfterTableCommand,\n  'Shift-Enter': moveSelectionAfterTableCommand,\n  Enter: moveToNextCellCommand,\n  Backspace: removeTableContentCommand,\n  Delete: removeTableContentCommand,\n  'Mod-Backspace': removeTableContentCommand,\n  'Mod-Delete': removeTableContentCommand,\n  Tab: moveToNextCellCommand,\n  'Shift-Tab': moveToPreviousCellCommand,\n};\n","export const tableNodeSpec = {\n  content: 'table_head table_body*',\n  isolating: true,\n  group: 'block',\n  selectable: false,\n  parseDOM: [{ tag: 'table' }],\n  toDOM() {\n    return ['div', { class: 's-table-container' }, ['table', { class: 's-table' }, 0]];\n  },\n};\n\nexport const tableHeadNodeSpec = {\n  content: 'table_row',\n  isolating: true,\n  group: 'table_block',\n  selectable: false,\n  parseDOM: [{ tag: 'thead' }],\n  toDOM() {\n    return ['thead', 0];\n  },\n};\n\nexport const tableBodyNodeSpec = {\n  content: 'table_row+',\n  isolating: true,\n  group: 'table_block',\n  selectable: false,\n  parseDOM: [{ tag: 'tbody' }],\n  toDOM() {\n    return ['tbody', 0];\n  },\n};\n\nexport const tableRowNodeSpec = {\n  content: '(table_cell | table_header)+',\n  isolating: true,\n  group: 'table_block',\n  selectable: false,\n  parseDOM: [{ tag: 'tr' }],\n  toDOM() {\n    return ['tr', 0];\n  },\n};\n\nexport const tableCellNodeSpec = {\n  content: 'inline*',\n  isolating: true,\n  group: 'table_block',\n  selectable: false,\n  attrs: {\n    style: { default: null },\n  },\n  parseDOM: [\n    {\n      tag: 'td',\n      getAttrs(dom) {\n        const textAlign = dom.style.textAlign;\n        return textAlign ? { style: `text-align: ${textAlign}` } : null;\n      },\n    },\n  ],\n  toDOM(node) {\n    return ['td', node.attrs, 0];\n  },\n};\n\nexport const tableHeaderNodeSpec = {\n  content: 'inline*',\n  isolating: true,\n  group: 'table_block',\n  selectable: false,\n  attrs: {\n    style: { default: null },\n  },\n  parseDOM: [\n    {\n      tag: 'th',\n      getAttrs(dom) {\n        const textAlign = dom.style.textAlign;\n        return textAlign ? { style: `text-align: ${textAlign}` } : null;\n      },\n    },\n  ],\n  toDOM(node) {\n    return ['th', node.attrs, 0];\n  },\n};\n","module.exports = flarum.extensions['askvortsov-rich-text'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/Separator'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['common/helpers/listItems'];","module.exports = flarum.core.compat['common/utils/Stream'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['extend'];"],"sourceRoot":""}